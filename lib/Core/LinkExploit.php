<?php

/**
 * Class Core_LinkExploit
 */
class Core_LinkExploit {
	/**
	 *
	 */
	const KEY = 'asdf!@#$';


	/**
	 * @param string $id
	 * @return string
	 */
	public static function create($id = 'default') {
		if (s()->link_exploit->{$id}) {
			return s()->link_exploit->{$id};
		} else {
			$hash = md5($id . self::KEY . time());

			return s()->link_exploit->{$id} = $hash;
		}
	}

	/**
	 * @param $hash
	 * @param $id
	 * @return bool
	 */
	public static function checkOnce($hash, $id) {
		$rs = self::check($hash, $id);
		unset(s()->link_exploit->{$id});

		return $rs;
	}

	/**
	 * @param        $hash
	 * @param string $id
	 * @return bool
	 */
	public static function check($hash, $id = 'default') {
		$check_hash = s()->link_exploit->{$id};

		if (!$id || !$check_hash || !$hash || $check_hash != $hash) {
			return false;
		} else {
			return true;
		}
	}
}
